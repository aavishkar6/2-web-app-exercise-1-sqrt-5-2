{% extends 'layouts/layout.html' %}

{% block head %}
<link rel="stylesheet" href="/static/css/index.css">
{% endblock %}

{% block title %}Home{% endblock %}

{% block banner %}
{% if not user %}
<img src="/images/sharing-tomato.jpg" alt="Banner" />
{% endif %}
{% endblock %}


{% block content %}

<div class="page-content">

    {% if user %}

    {% if listings %}
    <h1> Your Listings </h1>
    <div class="card-grid">
        {% for food in listings %}
        <div class="card" onclick="location.href='/listings/{{ food._id }}'">
            <img src="/images/{{ food.photo }}" alt="{{ food.name }}">
            <h2>{{ food.name }}</h2>
            <div class="card-info">
                <p class="price">$ {{ food.price }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if reservations %}
    <h1> Your Reservations </h1>
    <div class="card-grid">
        {% for food in reservations %}
        <div class="card" onclick="location.href='/listings/{{ food._id }}'">
            <img src="/images/{{ food.photo }}" alt="{{ food.name }}">
            <h2>{{ food.name }}</h2>
            <div class="card-info">
                <p class="price">$ {{ food.price }}</p>
                {% if food.distance %}
                <p class="distance">
                    {% if food.distance > 1000 %}
                    {{ (food.distance/1000)|round(1) }} km away
                    {% else %}
                    {{ food.distance|round(1) }} m away
                    {% endif %}
                </p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if near %}
    <h1> Food Near You </h1>
    {% if user.location.coordinates[0] != 0 or user.location.coordinates[1] != 0 %}
    <div class="card-grid">
        {% for food in near %}
        {% if food.user_id != user_id %}
        <div class="card" onclick="location.href='/listings/{{ food._id }}'">
            <img src="/images/{{ food.photo }}" alt="{{ food.name }}">
            <h2>{{ food.name }}</h2>
            <div class="card-info">
                <p class="price">$ {{ food.price }}</p>
                {% if food.distance %}
                <p class="distance">
                    {% if food.distance > 1000 %}
                    {{ (food.distance/1000)|round(1) }} km away
                    {% else %}
                    {{ food.distance|round(1) }} m away
                    {% endif %}
                </p>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <h3 class="warning">Fill in detailed location info in your profile to see listings near you!</h3>
    {% endif %}
    {% endif %}

    <h1>Recommended for You</h1>

    {% else %}

    <h1>Why Choose Us?</h1>
    <p>
        FoodForward helps you save money and resources while contributing to a more sustainable planet. We believe
        every
        meal matters, and even the smallest actions can have a
        significant impact when we all do our part. Join us on our journey towards zero food waste today!
    </p>

    <h1>Get Started</h1>

    <div>
        <p style="margin-bottom:5px;">If you already have an account, click the button below to log in.</p>
        <div class="button-container">
            <a href="{{ url_for('login') }}" class='btn'>Log In</a>
        </div>
    </div>

    <div>
        <p style="margin-bottom:5px;">If you're new to FoodForward, click the button below to get started.</p>
        <div class="button-container">
            <a href="{{ url_for('register') }}" class='btn'>Register</a>
        </div>
    </div>

    {% endif %}

</div>

{% endblock %}